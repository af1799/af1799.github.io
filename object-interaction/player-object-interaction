using UnityEngine;

public class ObjectInteraction : MonoBehaviour
{
    // This script is intended to be attached to the player object to allow object interaction with objects implementing the Interactable interace

    // Range is a float indicating the range in which the player can interact with an object
    public float range = 3;

    // Object currently being held; if nothing, is null
    private Interactable held = null;

    private Collider playerCollider;

    [SerializeField] private float horizontalOffset = 1.1f;
    [SerializeField] private float verticalOffset = 0.2f;
    [SerializeField] private float forwardOffset = 1.5f;

    void Start()
    {
        playerCollider = gameObject.GetComponent<Collider>();
    }

    void Update()
    {
        if (InputController.Instance.GetInteractDown())
        {
            if (held == null)
            {
                // The ray is determined by the camera position, the hit variable is where the
                // information about what the ray hits will be stored, and the range variable represents
                // the numerical range in which an object can be interacted with
                if (Physics.Raycast(Camera.main.gameObject.transform.position,
                Camera.main.gameObject.transform.forward, out RaycastHit hit, range))
                // If an object is within the range, is hit by the raycast, and has Interact component
                {
                    if (hit.collider.gameObject.TryGetComponent(out Rigidbody rb))
                    {
                        if (hit.rigidbody.gameObject.TryGetComponent(out Interact interactableObject))
                        // If the object hit has an Interactable component
                        {
                            interactableObject.Grab(playerCollider, horizontalOffset,
                                verticalOffset, forwardOffset);
                            held = interactableObject;
                        }
                    }
                }
            }
            else
            {
                held.Release();
                held = null;
            }

        }
        if (Input.GetKeyDown(KeyCode.Mouse0) && held != null)
        {
            held.Throw();
            held = null;
        }
    }
}
